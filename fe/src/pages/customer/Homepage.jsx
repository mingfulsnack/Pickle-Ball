import React, { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import './Homepage.scss';
import { publicApi } from '../../services/api';

const Homepage = () => {
  const navigate = useNavigate();
  const [bookingForm, setBookingForm] = useState({
    date: '',
    startTime: '',
    endTime: ''
  });
  const [courts, setCourts] = useState([]);
  const [services, setServices] = useState([]);
  const [loading, setLoading] = useState(false);

  useEffect(() => {
    fetchCourts();
    fetchServices();
  }, []);

  const fetchCourts = async () => {
    try {
      const response = await publicApi.get('/public/courts?activeOnly=true');
      setCourts(response.data.data || []);
    } catch (error) {
      console.error('Error fetching courts:', error);
    }
  };

  const fetchServices = async () => {
    try {
      const response = await publicApi.get('/public/services');
      setServices(response.data.data || []);
    } catch (error) {
      console.error('Error fetching services:', error);
    }
  };

  const handleInputChange = (e) => {
    const { name, value } = e.target;
    setBookingForm(prev => ({
      ...prev,
      [name]: value
    }));
  };

  const handleSearch = async () => {
    if (!bookingForm.date || !bookingForm.startTime || !bookingForm.endTime) {
      alert('Vui l√≤ng ch·ªçn ƒë·∫ßy ƒë·ªß th√¥ng tin');
      return;
    }

    setLoading(true);
    try {
      const response = await publicApi.get('/public/availability', {
        params: {
          date: bookingForm.date,
          start_time: bookingForm.startTime,
          end_time: bookingForm.endTime
        }
      });
      
      // Navigate to booking page with search results
      navigate('/booking', { 
        state: { 
          availability: response.data.data,
          searchParams: bookingForm
        }
      });
    } catch (error) {
      console.error('Error checking availability:', error);
      alert('C√≥ l·ªói x·∫£y ra khi ki·ªÉm tra t√¨nh tr·∫°ng s√¢n');
    } finally {
      setLoading(false);
    }
  };

  const handleBookNow = () => {
    navigate('/booking');
  };

  // Generate time options (6:00 AM to 10:00 PM)
  const timeOptions = [];
  for (let hour = 6; hour <= 22; hour++) {
    const time = `${hour.toString().padStart(2, '0')}:00`;
    timeOptions.push(time);
  }

  return (
    <div className="homepage">
      {/* Hero Section */}
      <section className="hero-section">
        <div className="hero-content">
          <div className="hero-left">
            <div className="feature-badge">
              <span className="leaf-icon">üåø</span>
              <span>Easy court rentals</span>
            </div>
            <h1 className="hero-title">
              Thu√™ s√¢n pickleball ngay ch·ªâ trong v√†i gi√¢y
            </h1>
            <p className="hero-description">
              Real-time availability, flexible time slots, and hassle-free 
              management. Book your racquet and play today!
            </p>
            <button className="cta-button" onClick={handleBookNow}>
              ƒê·∫∑t ngay
            </button>
          </div>
          <div className="hero-right">
            <div className="hero-image">
              <img 
                src="/src/assets/pickleball-court.jpg" 
                alt="S√¢n pickleball"
                onError={(e) => {
                  e.target.style.display = 'none';
                  e.target.nextSibling.style.display = 'flex';
                }}
              />
              <div className="image-placeholder" style={{display: 'none'}}>
                <span>üèì</span>
                <p>S√¢n Pickleball</p>
              </div>
            </div>
          </div>
        </div>
      </section>

      {/* Feature Highlights */}
      <section className="features-section">
        <div className="features-container">
          <div className="feature-card">
            <div className="feature-icon">üìç</div>
            <h3>S√¢n c√≥ s·∫µn</h3>
            <p>Lu√¥n c√≥ s√¢n tr·ªëng ƒë·ªÉ b·∫°n l·ª±a ch·ªçn trong ng√†y</p>
          </div>
          <div className="feature-card">
            <div className="feature-icon">‚è∞</div>
            <h3>Gi·ªù ch∆°i linh ho·∫°t</h3>
            <p>ƒê·∫∑t s√¢n theo th·ªùi gian ph√π h·ª£p v·ªõi l·ªãch tr√¨nh c·ªßa b·∫°n</p>
          </div>
          <div className="feature-card">
            <div className="feature-icon">üéØ</div>
            <h3>∆Øu ƒë√£i ƒë·∫∑c bi·ªát</h3>
            <p>Nh·∫≠n gi·∫£m gi√° v√† khuy·∫øn m√£i h·∫•p d·∫´n m·ªói th√°ng</p>
          </div>
        </div>
      </section>

      {/* Booking Search Bar */}
      <section className="search-section">
        <div className="search-container">
          <div className="search-form">
            <div className="form-group">
              <label>üìÖ Ch·ªçn ng√†y</label>
              <input
                type="date"
                name="date"
                value={bookingForm.date}
                onChange={handleInputChange}
                min={new Date().toISOString().split('T')[0]}
              />
            </div>
            <div className="form-group">
              <label>Gi·ªù b·∫Øt ƒë·∫ßu</label>
              <select
                name="startTime"
                value={bookingForm.startTime}
                onChange={handleInputChange}
              >
                <option value="">Ch·ªçn gi·ªù</option>
                {timeOptions.map(time => (
                  <option key={time} value={time}>{time}</option>
                ))}
              </select>
            </div>
            <div className="form-group">
              <label>Gi·ªù k·∫øt th√∫c</label>
              <select
                name="endTime"
                value={bookingForm.endTime}
                onChange={handleInputChange}
              >
                <option value="">Ch·ªçn gi·ªù</option>
                {timeOptions.map(time => (
                  <option key={time} value={time}>{time}</option>
                ))}
              </select>
            </div>
            <button 
              className="search-button" 
              onClick={handleSearch}
              disabled={loading}
            >
              {loading ? 'üîÑ' : 'üîç'} T√¨m ki·∫øm
            </button>
          </div>
        </div>
      </section>

      {/* Customer Services */}
      <section className="services-section">
        <div className="services-container">
          <h2 className="section-title">D·ªãch v·ª• kh√°ch h√†ng</h2>
          <div className="services-grid">
            <div className="service-card">
              <div className="service-image">
                <div className="placeholder-image">
                  <span>‚è∞</span>
                </div>
              </div>
              <h3>ƒê√°p ·ª©ng m·ªçi khung gi·ªù</h3>
              <p>
                Pickleball B·ªì ƒê·ªÅ cung c·∫•p d·ªãch v·ª• cho thu√™ s√¢n t·ª´ 6h s√°ng ƒë·∫øn 10h t·ªëi, 
                ph√π h·ª£p v·ªõi m·ªçi l·ªãch tr√¨nh c·ªßa b·∫°n. H·ªá th·ªëng ƒë·∫∑t s√¢n tr·ª±c tuy·∫øn 
                gi√∫p b·∫°n d·ªÖ d√†ng ch·ªçn th·ªùi gian ph√π h·ª£p.
              </p>
              <ul className="service-features">
                <li>‚úÖ M·ªü c·ª≠a t·ª´ 6h s√°ng ƒë·∫øn 10h t·ªëi</li>
                <li>‚úÖ ƒê·∫∑t s√¢n tr·ª±c tuy·∫øn 24/7</li>
                <li>‚úÖ X√°c nh·∫≠n ƒë·∫∑t s√¢n t·ª©c th√¨</li>
              </ul>
            </div>

            <div className="service-card">
              <div className="service-image">
                <div className="placeholder-image">
                  <span>üèÜ</span>
                </div>
              </div>
              <h3>Ti·ªán √≠ch cao c·∫•p</h3>
              <p>
                H·ªá th·ªëng s√¢n ƒë∆∞·ª£c trang b·ªã ƒë·∫ßy ƒë·ªß ti·ªán nghi hi·ªán ƒë·∫°i, 
                t·ª´ thi·∫øt b·ªã cho thu√™ ƒë·∫øn d·ªãch v·ª• h·ªó tr·ª£ chuy√™n nghi·ªáp. 
                Mang ƒë·∫øn tr·∫£i nghi·ªám ch∆°i t·ªët nh·∫•t cho kh√°ch h√†ng.
              </p>
              <ul className="service-features">
                <li>‚úÖ Thi·∫øt b·ªã cho thu√™ ch·∫•t l∆∞·ª£ng cao</li>
                <li>‚úÖ S√¢n ti√™u chu·∫©n qu·ªëc t·∫ø</li>
                <li>‚úÖ H·ªá th·ªëng chi·∫øu s√°ng LED</li>
              </ul>
            </div>

            <div className="service-card">
              <div className="service-image">
                <div className="placeholder-image">
                  <span>üíé</span>
                </div>
              </div>
              <h3>ƒê·∫≥ng c·∫•p d·ªãch v·ª•</h3>
              <p>
                ƒê·ªôi ng≈© nh√¢n vi√™n chuy√™n nghi·ªáp, t·∫≠n t√¢m ph·ª•c v·ª• kh√°ch h√†ng 
                v·ªõi th√°i ƒë·ªô nhi·ªát t√¨nh. Cam k·∫øt mang ƒë·∫øn tr·∫£i nghi·ªám 
                ƒë·∫∑t s√¢n v√† ch∆°i th·ªÉ thao tuy·ªát v·ªùi nh·∫•t.
              </p>
              <ul className="service-features">
                <li>‚úÖ Nh√¢n vi√™n h·ªó tr·ª£ 24/7</li>
                <li>‚úÖ Ch√≠nh s√°ch ho√†n ti·ªÅn linh ho·∫°t</li>
                <li>‚úÖ Ch∆∞∆°ng tr√¨nh kh√°ch h√†ng th√¢n thi·∫øt</li>
              </ul>
            </div>
          </div>
        </div>
      </section>

      {/* Stats Section (Optional) */}
      <section className="stats-section">
        <div className="stats-container">
          <div className="stat-item">
            <div className="stat-number">{courts.length}+</div>
            <div className="stat-label">S√¢n c√≥ s·∫µn</div>
          </div>
          <div className="stat-item">
            <div className="stat-number">{services.length}+</div>
            <div className="stat-label">D·ªãch v·ª•</div>
          </div>
          <div className="stat-item">
            <div className="stat-number">1000+</div>
            <div className="stat-label">Kh√°ch h√†ng h√†i l√≤ng</div>
          </div>
          <div className="stat-item">
            <div className="stat-number">24/7</div>
            <div className="stat-label">H·ªó tr·ª£ tr·ª±c tuy·∫øn</div>
          </div>
        </div>
      </section>

      {/* Footer */}
      <footer className="footer-section">
        <div className="footer-container">
          <div className="footer-content">
            <div className="footer-logo">
              <div className="logo-icon">üçé</div>
              <span className="logo-text">Pickleball B·ªì ƒê·ªÅ</span>
            </div>
            <div className="footer-info">
              <p>H·ªá th·ªëng s√¢n pickleball hi·ªán ƒë·∫°i v√† chuy√™n nghi·ªáp</p>
              <p>üìç ƒê·ªãa ch·ªâ: 123 ƒê∆∞·ªùng ABC, Qu·∫≠n XYZ, TP. H·ªì Ch√≠ Minh</p>
              <p>üìû Hotline: 0900 123 456</p>
              <p>‚úâÔ∏è Email: contact@pickleballbode.com</p>
            </div>
          </div>
          <div className="footer-bottom">
            <p>&copy; 2025 Pickleball B·ªì ƒê·ªÅ. All rights reserved.</p>
          </div>
        </div>
      </footer>
    </div>
  );
};

export default Homepage;